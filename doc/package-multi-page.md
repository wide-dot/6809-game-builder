# Package: multi-page


## File structure

**package.xml**

    <package id="1" type="multi-page" compression="zx0" ram="$0000-3FFF" start-offset="$0" cluster-size="$2000">
        <asm>src/sample-gfx/object/obj01/obj01.asm</asm>
        <asm>src/sample-gfx/object/obj02/obj02.asm</asm>
        <asm>src/sample-gfx/object/obj03/obj03.asm</asm>
    </package>


Loading parameters:
- package id
- page


TODO - a mettre a jour :

In package-elements field, the values for :
 - compression
 - cluster-size
 - location
 - org

are the default values for package elements. Those values can be overided in each package-element.

The path of each file must be relative to the game project base directory.  

The builder will report a fatal error if the binary produced for the package exceed the size declared by the end location minus the org starting position.

### compression
---

value|version|description|direction
-|-|-|-
none|1|stack blast copy (preprocessed data)|backward
exo|2|exomizer|backward
zx0|1|zx0|forward

### cluster-size
---

The cluster size allows you to load a page in several steps.  

Use case with the TO8 Thomson :

There is a distortion between RAM locations in the TO8 memory management.  
Here is the correspondence between the two locations :  
cartridge|data
-|-
$0000-$1FFF|$C000-DFFF
$2000-$3FFF|$A000-BFFF

Builder strategy
- the package element is builded in a 16KiB space :  

        <location>$0000-$3FFF</location>

- the package element is clustered in 8KiB :

        <cluster-size>$2000</cluster-size>

- the builder will write an index with two 8KiB entries

Loader strategy
- the loader will handle address translation and invert the two 8KiB bank, based on destination provided by the index

### location
---

The location is the expected running location for the code.

The location is used to :
- set the destination location in the package index.  
- give the destination page size, used to split the package into pages.

The value should be expressed in hexadecimal with an hyphen between the min and max value.  
example : $0000-$3FFF

### org
---

The org sets the origin where the package begin, somewhere in a middle of a page. It is also used to assemble the code to the right location.
The value should be expressed in hexadecimal.

## Package element definition
---

A package element is a set of assembly files that will be assembled to make a binary. This binary will be loaded in a countiguous RAM space at runtime.

![package-element][package-element]

## File structure

The package element is an assembly file that includes other assembly files.  
This file can be created manually or generated by a tool.  
The tool will find the layout that uses the less page space.
			
01.asm
---------

    INCLUDE "obj01/obj01.asm"
    INCLUDE "obj01/image/img01.asm"	
    INCLUDE "obj01/image/img02.asm"
    INCLUDE "obj01/image/img03.asm"			
						
		
dans le code on a besoin de faire référence à la page d'un objet
on déclare dans les constantes :
PAGE_IDX equ 0
			
on déclare dans l'objet buzzer :
pge_ehz_buzzer equ PAGE_IDX
			
on utilise dans le code ailleurs :
lda   #pge_ehz_buzzer			
			
extraire des fichiers objets du package, les addresses d'utilisation des equates de tous les asm (liste plus haut)
construction d'un index pour chaque mention :
package id; page offset référence, adresse référence, page offset cible dans le package courant ou dans un autre
			
quand on référence une adresse de routine on a une adresse + offset de page dans le package
L'adresse est résolue par link

[package-element]: package-element.png